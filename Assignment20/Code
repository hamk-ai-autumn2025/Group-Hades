<!doctype html>
<html lang="fi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ice Cream Freezer — Platformer</title>
<style>
  body { margin: 0; background: linear-gradient(#9ee7ff, #e6f9ff); display: flex; justify-content: center; align-items: center; height: 100vh; }
  canvas { background: linear-gradient(#c9f1ff, #fff); border: 3px solid #333; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.25); }
</style>
</head>
<body>
<canvas id="game" width="900" height="500"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width;
const H = canvas.height;

// Pelaaja (jäätelö)
const player = {
  x: 60, y: H - 140, w: 50, h: 70,
  vx: 0, vy: 0, grounded: false,
  jumps: 0, maxJumps: 2 // tupla hyppy
};

// Yksinkertaiset alustat
const platforms = [
  { x: 0, y: H - 40, w: W, h: 40 },
  { x: 200, y: H - 160, w: 140, h: 16 },
  { x: 420, y: H - 240, w: 160, h: 16 },
  { x: 680, y: H - 180, w: 160, h: 16 }
];

// Pakastin
const freezer = { x: W - 120, y: H - 140, w: 80, h: 100 };

// Sulaminen
let melt = 0;
let gameOver = false;

let keys = {};

window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

function physics(dt){
  if(gameOver) return;

  // Liike
  if(keys['ArrowLeft'] || keys['a']) player.vx = -220;
  else if(keys['ArrowRight'] || keys['d']) player.vx = 220;
  else player.vx = 0;

  // Hyppy ja tupla hyppy
  if((keys[' '] || keys['ArrowUp'] || keys['w']) && player.jumps < player.maxJumps){
    if(!player.jumpPressed){
      player.vy = -420;
      player.jumps++;
      player.jumpPressed = true;
    }
  } else {
    player.jumpPressed = false;
  }

  // Painovoima
  player.vy += 1000 * dt;

  // Päivitys
  player.x += player.vx * dt;
  player.y += player.vy * dt;

  player.grounded = false;

  // Törmäykset alustoihin
  for(const p of platforms){
    if(player.x < p.x + p.w && player.x + player.w > p.x &&
       player.y < p.y + p.h && player.y + player.h > p.y){
      // Pelaaja putosi alustan päälle
      if(player.vy > 0){
        player.y = p.y - player.h;
        player.vy = 0;
        player.grounded = true;
        player.jumps = 0;
      }
    }
  }

  // Lattia
  if(player.y + player.h > H - 40){
    player.y = H - 40 - player.h;
    player.vy = 0;
    player.grounded = true;
    player.jumps = 0;
  }

  // Seinät
  if(player.x < 0) player.x = 0;
  if(player.x + player.w > W) player.x = W - player.w;

  // Pakastimeen
  if(player.x + player.w > freezer.x && player.y + player.h > freezer.y){
    gameOver = true;
    alert("✔️ Voitit! Jäätelö pääsi pakastimeen.");
  }

  // Sulaminen
  melt += 12 * dt;
  if(melt >= 100){
    gameOver = true;
    alert("❌ Hävisit! Jäätelö suli kokonaan.");
  }
}

function drawIceCream(x,y,w,h){
  // Koko jäätelö
  ctx.save();
  ctx.translate(x,y);

  // Voimakkuus sulamisesta vaikuttaa kokoon
  const scale = 1 - melt/200;
  ctx.scale(scale,scale);

  // Tötterö
  ctx.fillStyle = "#d8a15d";
  ctx.beginPath();
  ctx.moveTo(0,h);
  ctx.lineTo(w/2,0);
  ctx.lineTo(w,h);
  ctx.closePath();
  ctx.fill();

  // Pallo
  ctx.fillStyle = "#fff0f0";
  ctx.beginPath();
  ctx.arc(w/2,0, w/2, 0, Math.PI*2);
  ctx.fill();

  // Hymynaama
  ctx.fillStyle = "#222";
  ctx.beginPath(); ctx.arc(w/2 - 10, -5, 3, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(w/2 + 10, -5, 3, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(w/2, 5, 12, 0, Math.PI); ctx.stroke();

  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,W,H);

  // Tausta
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,"#9ee7ff");
  g.addColorStop(1,"#e6f9ff");
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // Alustat
  ctx.fillStyle = "#6b4b2b";
  for(const p of platforms){
    ctx.fillRect(p.x,p.y,p.w,p.h);
  }

  // Pakastin
  ctx.fillStyle = "#e0f8ff";
  ctx.fillRect(freezer.x, freezer.y, freezer.w, freezer.h);
  ctx.strokeStyle = "#003366";
  ctx.strokeRect(freezer.x, freezer.y, freezer.w, freezer.h);
  ctx.fillStyle = "#003366";
  ctx.fillText("Pakastin", freezer.x + 5, freezer.y + 20);

  // Pelaaja
  drawIceCream(player.x, player.y, player.w, player.h);

  // UI
  ctx.fillStyle = "#000";
  ctx.fillText("Sulamisaste: " + melt.toFixed(0) + "%", 10, 20);
}

let last = null;
function loop(ts){
  if(!last) last = ts;
  const dt = (ts - last)/1000;
  last = ts;
  physics(dt);
  draw();
  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>
</body>
</html>

